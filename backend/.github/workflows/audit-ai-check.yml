name: AuditAI Security Gatekeeper

# Trigger this workflow on every push or pull request
on: [push, pull_request]

jobs:
  ai-security-audit:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Check out the code
    - uses: actions/checkout@v3

    # 2. Set up Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 3. Install your Backend dependencies
    - name: Install Dependencies
      run: |
        cd backend
        pip install -r requirements.txt

    # 4. RUN THE AUDIT
    # We inject the API Key from GitHub Secrets into the script
    - name: Run AuditAI Cyber Check
      env:
        AUDIT_API_KEY: ${{ secrets.AUDIT_API_KEY }}
        AUDIT_PROVIDER: "gemini/gemini-1.5-flash"
        AUDIT_TRAP: "cyber"
      run: |
        cd backend
        python ci_runner.py